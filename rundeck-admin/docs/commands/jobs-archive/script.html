<!DOCTYPE html>
<html>
<head>
    <meta http-equiv='content-type' content='text/html;charset=utf-8'>
    <title>jobs-archive</title>
    <link rel="stylesheet" media="all" href="http://jashkenas.github.io/docco/resources/linear/public/stylesheets/normalize.css" />
    <link rel="stylesheet" media="all" href="http://jashkenas.github.io/docco/resources/linear/docco.css" />
</head>
<body>
<div class="container">
  <div class="page">
        <div class="header"><h1>jobs-archive</h1></div>
        <p>To implement this command, edit the &ldquo;Command implementation&rdquo; section below.</p>

</pre></div>

<h2>Usage</h2>

</pre></div>

<p>Comments prefixed with <code>#/</code> are managed by stubbs.
The <code>command</code> and <code>usage</code> comments describe the command
and show its options.</p>

</pre></div>

<h2>Load common functions</h2>

</pre></div>

<p>Load the function library for this module.
This loads rerun functions, too.</p>

</pre></div>

<h2>Error handling</h2>

</pre></div>

<p>This script is designed to <em>fail-fast</em>.</p>

</pre></div>

<p>Trap errors and exit. The call to <code>rerun_die</code> will print the
the error message and exit with the error command exit status.</p>

</pre></div>

<p>Run <a href="http://ss64.com/bash/set.html">set</a> <code>nounset</code> to treat unset variables as errors. Set <a href="http://www.gnu.org/software/bash/manual/html_node/Pipelines.html">pipefail</a>
so a pipeline return status is the value of the last
(rightmost) command to exit with non-zero status.</p>

</pre></div>

<h2>Command variables</h2>

</pre></div>

<p>This command script can access the following variables
declared by <code>rerun</code> or by the option parser function.</p>

</pre></div>

<p>The <code>rerun_options_parse</code> function processes the command line
arguments. Each accepted command line flag results in setting
one the corresponding option variables.</p>

</pre></div>

<h2>Command implementation</h2>

</pre></div>

<p>Set the options to sensible defaults.</p>

<p>Check DIR exists and if not set, use current working directory.</p>

</pre></div>

<p>Ensure it exists in case it was user specified.</p>

</pre></div>

<p>PROJECT is really just informational.</p>

</pre></div>

<p>Default the archive to the name of the specified directory.</p>

</pre></div>

<p>Ensure the archive is absolute and relative to PWD</p>

</pre></div>

<p>Create a workspace directory structure for the archive content.</p>

</pre></div>

<p>Create the metadata for the archive.</p>

</pre></div>

<p>Create the archive payload. Just looking for job definitions files.
The executions and reports subdirs will stay empty.</p>

</pre></div>

<p>Recursively, process any XML files that contain /joblist/job elements and add them to the archive dir.
Each file found will be counted and named after its position in the count.</p>

</pre></div>

<p>copy the job definition to the work dir using file name format: job-{count}.{extension}</p>

</pre></div>

<p>Create the archive only if there were job(s) copied to the work dir.</p>

</pre></div>

<p>change directory to the workdir so the archive files are relative.</p>

</pre></div>

<p>Done. Exit with last command exit status.</p>

</pre></div>

</pre></div>
  </div>
  <div class="fleur">h</div>

</div>
</body>
</html>
